{include file="public/header" /}

<style type="text/css">
  /*隐藏全选checkbox*/
  .layui-table th .layui-unselect{
      display: none;
  }
</style>
<body>
        <!-- 右侧主体结束 -->
    <div class="x-body layui-anim layui-anim-up">
        <!-- 右侧内容框架，更改从这里开始 -->
        <form class="layui-form"  action="/sys/hospital/update" method="post" enctype="multipart/form-data">
            <div class="layui-form-item">
              <label for="org_name" class="layui-form-label">名称<?php html_sign();?></label>
              <div class="layui-input-block">
                <input type="text" id="org_name" name="org_name" lay-verify="required" autocomplete="off"
                      value="{$list.org_name|default=''}" class="layui-input">
              </div>
            </div>
            <input type="hidden" name="type" value="1">
            <div class="layui-form-item">
              <label for="address" class="layui-form-label">地址</label>
              <div class="layui-input-block">
                <input type="text" id="address" name="address"  autocomplete="off"
                      value="{$list.address|default=''}" class="layui-input">
              </div>
            </div>

            <div class="layui-form-item">
              <label for="tel" class="layui-form-label">电话</label>
              <div class="layui-input-block">
                <input type="text" id="tel" name="tel"  autocomplete="off"
                      value="{$list.tel|default=''}" class="layui-input">
              </div>
            </div>

            <div class="layui-form-item">
              <label for="fax" class="layui-form-label">传真</label>
              <div class="layui-input-block">
                <input type="text" id="fax" name="fax"  autocomplete="off"
                      value="{$list.fax|default=''}" class="layui-input">
              </div>
            </div>


            <div class="layui-form-item">
              <label for="web_url" class="layui-form-label">官网<?php html_sign();?></label>
              <div class="layui-input-block">
                <input type="text" id="web_url" name="web_url" lay-verify="required" autocomplete="off"
                      value="{$list.web_url|default=''}" class="layui-input">
              </div>
            </div>

            <div class="layui-form-item">
              <label class="layui-form-label">省份</label>
              <div class="layui-input-block">
                <select name="province_id" lay-verify="" lay-search="" lay-filter="province">
                  <option value="">直接选择或搜索选择</option>
                    {volist name="province_list" id="vo"}
                    <option value="{$vo['fid']}" {if condition="isset($vo['fid']) and $vo['fid'] eq $list.province_id"}selected="selected"{/if}>{$vo['region_name']}</option>
                    {/volist}
                </select>
              </div>
          </div>

          <div class="layui-form-item">
              <label class="layui-form-label">城市</label>
              <div class="layui-input-block">
                <select name="city_id" lay-verify="" lay-search="" id="city" lay-filter="city">
                  <option value="">直接选择或搜索选择</option>
                    {volist name="city_list" id="vo"}
                    <option value="{$vo['fid']}" {if condition="isset($vo['fid']) and $vo['fid'] eq $list.city_id"}selected="selected"{/if}>{$vo['region_name']}</option>
                    {/volist}
                </select>
              </div>
          </div>

          <div class="layui-form-item">
              <label class="layui-form-label">区/县</label>
              <div class="layui-input-block">
                <select name="country_id" lay-verify="" lay-search="" id="country">
                  <option value="">直接选择或搜索选择</option>
                    {volist name="country_list" id="vo"}
                    <option value="{$vo['fid']}" {if condition="isset($vo['fid']) and $vo['fid'] eq $list.country_id"}selected="selected"{/if}>{$vo['region_name']}</option>
                    {/volist}
                </select>
              </div>
          </div>


            <div class="layui-form-item">
              <label class="layui-form-label">公司图片</label>
              <div class="layui-upload">
                <div style="float: left; width: 150px; text-align: center;">
                  <button type="button" class="layui-btn" id="img">上传图片</button>
                  <div class="layui-upload-list">
                    <img class="layui-upload-img" id="img1" width="150" src="{$list['image_url']|default=''}">
                  </div>
                </div>
            </div>

              <label class="layui-form-label">营业执照</label>
              <div class="layui-upload">
                <div style="float: left; width: 150px; text-align: center;">
                  <button type="button" class="layui-btn" id="imgs">上传图片</button>
                  <div class="layui-upload-list">
                    <img class="layui-upload-img" id="img2" width="150" src="{$list['image_urls']|default=''}">
                  </div>
                </div>
            </div>

            <input type="hidden" name="web_image_id" id="FImageUrl" value="{$list['web_image_id']|default=''}">
            <input type="hidden" name="licence_id" id="FImageUrls" value="{$list['licence_id']|default=''}">
            <input type="hidden" name="fid" value="{$list.fid|default=''}">
            <div class="layui-form-item">
              <label for="description" class="layui-form-label">简介</label>
              <div class="layui-input-block">
                <textarea placeholder="请输入内容" class="layui-textarea" type="text" id="description" name="description">{$list.description|default=''}</textarea>
              </div>
            </div>

            <div class="layui-form-item">
              <label class="layui-form-label xbs768">状态</label>
              <div class="layui-input-block">
                <input type="radio" name="record_status" value="1" title="启用" checked>
                <input type="radio" name="record_status" value="2" title="禁用" {if condition="isset($list['record_status']) && $list['record_status'] eq 2"} checked {/if}>
                <input type="radio" name="record_status" value="-1" title="标记删除" {if condition="isset($list['record_status']) &&  $list['record_status'] eq -1"} checked {/if}>
              </div>
            </div>
            <div class="layui-form-item">
              <label  class="layui-form-label"></label>
              <button class="layui-btn" lay-filter="add" lay-submit="">保存</button>
            </div>
        </form>
        <!-- 右侧内容框架，更改从这里结束 -->
    </div>
    <!-- 中部结束 -->

</body>

<script>
  layui.use(['upload','form'],function(){
    var upload = layui.upload;
    var web_image_id='{$list.web_image_id|default=0}';
    var licence_id='{$list.licence_id|default=0}';
    //普通图片上传
    upload.render({
      elem: '#img'
      ,url: '/upload'
      ,data: {web_image_id:web_image_id}
      ,acceptMime: 'image/*'
      ,before: function(obj){
        obj.preview(function(index, file, result){
          $('#img1').attr('src', result);
        });
      }
      ,done: function(res){
        //如果上传失败
        console.log(res);
        if(res.code==200){
          $('#FImageUrl').attr('value', res.data);
          return layer.msg('上传成功');
        }else{
          return layer.msg('上传失败');
        }
      }
    });

    upload.render({
      elem: '#imgs'
      ,url: '/upload'
      ,data: {licence_id:licence_id}
      ,acceptMime: 'image/*'
      ,before: function(obj){
        obj.preview(function(index, file, result){
          $('#img2').attr('src', result);
        });
      }
      ,done: function(res){
        //如果上传失败
        console.log(res);
        if(res.code==200){
          $('#FImageUrls').attr('value', res.data);
          return layer.msg('上传成功');
        }else{
          return layer.msg('上传失败');
        }
      }
    });

    var form = layui.form;
    form.on('select(province)', function(data){
      $.getJSON("/sys/region?pid="+data.value, function(data){
          var optionstring = "";
          $.each(data.region, function(i,item){
              optionstring += "<option value=\"" + item.fid + "\" >" + item.region_name + "</option>";
          });
          $("#city").html('<option value=""></option>' + optionstring);
          $("#country").html('<option value=""></option>');
          form.render('select'); //这个很重要
      });
    });

    form.on('select(city)', function(data){
      $.getJSON("/sys/region?pid="+data.value, function(data){
          var optionstring = "";
          $.each(data.region, function(i,item){
              optionstring += "<option value=\"" + item.fid + "\" >" + item.region_name + "</option>";
          });
          $("#country").html('<option value=""></option>' + optionstring);
          form.render('select'); //这个很重要
      });
    });


  });
</script>
</html>